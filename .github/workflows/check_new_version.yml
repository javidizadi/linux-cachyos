name: check new version

on:
#  schedule:
#    - cron:  '15,40 * * * *'

  workflow_dispatch:

jobs:
  check-new-version:
    runs-on: ubuntu-latest
    outputs:
      new_version: ${{ steps.check.is_new }}
    steps:
      - uses: actions/checkout@v3

      - name: check for new version
        id: check
        run: |
          echo "Syncing fork repository from its parent..."
          gh repo sync javidizadi/linux-cachyos -b master
          set +e
          git pull | grep -q -e "^ ${{ env.PACKAGE_NAME }}\/"
          new_update=$?
          set -e
          if [ $new_update -eq 0 ]; then
            echo "New update available!"
            echo "is_new=true" >> "$GITHUB_OUTPUT"
          else
            echo "No new update found."
          fi


  call-build-workflow:
    needs: check-new-version
    if: ${{ needs.build.outputs.new_version == 'true' }}
    uses: javidizadi/linux-cachyos/.github/workflows/build.yml@master
    

env:
  PACKAGE_NAME: "linux-cachyos"
  GH_TOKEN: ${{ github.token }}
