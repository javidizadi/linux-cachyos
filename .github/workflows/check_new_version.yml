name: Check new version

on:
  schedule:
    - cron:  '15,40 * * * *'

  workflow_dispatch:

jobs:
  check-new-version:
    runs-on: ubuntu-latest
    outputs:
      new_version: ${{ steps.check.is_new }}
    steps:
      - uses: actions/checkout@v3

      - name: Check for new version
        id: check
        run: |
          prev_commit_id=$(git rev-parse HEAD)
          echo "Syncing fork repository from its parent..."
          gh repo sync javidizadi/linux-cachyos -b master
          git pull
          new_commit_id=$(git rev-parse HEAD)
          different=$(git diff ${prev_commit_id} ${new_commit_id} -- ${{ env.PACKAGE_NAME }})
          if [ -n "$different" ]; then
            echo "is_new=true" >> "$GITHUB_OUTPUT"
          fi

  call-build-workflow:
    needs: check-new-version
    if: ${{ needs.build.outputs.new_version == 'true' }}
    uses: javidizadi/linux-cachyos/.github/workflows/build.yml@master
    

env:
  PACKAGE_NAME: "linux-cachyos"
  GH_TOKEN: ${{ github.token }}